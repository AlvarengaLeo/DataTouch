Este documento est√° pensado para que un agente de desarrollo (LLM):

Comprenda completamente el modelo de negocio de DATA TOUCH.

Dise√±e y genere la arquitectura de software (soluci√≥n .NET 9, proyectos, carpetas, archivos base).

Implemente paso a paso el MVP 0.1, siguiendo lineamientos de stack, aristas y m√≥dulos.

Todas las instrucciones est√°n organizadas y etiquetadas por:

ARISTA (1, 2 o 3).

M√ìDULO (AUTH, LEADS, CARDS, etc.).

FASE (MVP 0.1 vs futuro).

‚ö†Ô∏è INSTRUCCI√ìN CR√çTICA PARA EL AGENTE
En esta primera etapa, SOLO debes implementar el MVP 0.1, centrado en ARISTA 2 (CRM del cliente) y ARISTA 3 (Landing p√∫blica / Business Card).
La ARISTA 1 (MultiSaaS / Panel del due√±o de la plataforma) debe quedar contemplada a nivel de dise√±o y modelo de datos b√°sico, pero NO se implementa a√∫n en UI ni l√≥gica compleja.

1. VISI√ìN GENERAL DEL MODELO DE NEGOCIO
1.1 Concepto central

DATA TOUCH es una plataforma SaaS que convierte tarjetas NFC/QR en un punto de entrada digital:

El visitante escanea la tarjeta.

Se abre una Landing / Business Card personalizada (ARISTA 3).

El visitante puede enviar sus datos (formulario de contacto).

Esos datos se guardan como Lead en el CRM de la empresa cliente (ARISTA 2).

La empresa gestiona esos leads en un panel con login.

En el futuro (no en este MVP), el sistema tambi√©n contempla:

Reservas, citas, cotizaciones, pagos, BI y automatizaciones.

Un panel de MultiSaaS para el due√±o de DATA TOUCH (ARISTA 1).

1.2 Las tres aristas (capas del sistema)

ARISTA 1 ‚Äì MULTISAAS / PANEL DEL DUE√ëO (FUTURO)
Es el panel que usar√≠a el due√±o de DATA TOUCH para ver:

Empresas (tenants), planes, suscripciones.

Facturaci√≥n, uso, dominios custom, m√©tricas globales.

ARISTA 2 ‚Äì CRM DEL CLIENTE (MVP 0.1 S√ç)
Es el panel que usa cada empresa cliente:

Login interno.

Gesti√≥n de leads.

Gesti√≥n de tarjetas (perfiles de usuarios).

ARISTA 3 ‚Äì LANDING / BUSINESS CARD P√öBLICA (MVP 0.1 S√ç)
Es lo que ve el visitante al escanear el NFC/QR:

Perfil del usuario (foto, nombre, puesto, etc.).

Botones de contacto (WhatsApp, tel√©fono, email).

Formulario de contacto ‚Üí crea un Lead.

2. ALCANCE FUNCIONAL DEL MVP 0.1

üéØ OBJETIVO DEL MVP 0.1
Implementar un flujo completo:
Escaneo ‚Üí Landing ‚Üí Formulario de contacto ‚Üí Lead ‚Üí Vista en CRM del cliente

2.1 Aristas incluidas en el MVP 0.1

‚úÖ ARISTA 2 ‚Äì CRM DEL CLIENTE (B√ÅSICO)

Multi-tenant simple (Organization, User).

Login.

Pantalla de leads.

Pantalla de ‚ÄúMis tarjetas‚Äù.

‚úÖ ARISTA 3 ‚Äì LANDING / BUSINESS CARD

Render de tarjeta p√∫blica.

Formulario de contacto.

Llamada al API para crear Lead.

2.2 Aristas NO incluidas en el MVP 0.1

‚ùå ARISTA 1 ‚Äì MULTISAAS / PANEL DEL DUE√ëO

No implementar UI ni l√≥gica de planes, billing, dominios custom, m√©tricas globales.

Solo preparar modelo de datos m√≠nimo para Organization que ser√° reutilizado luego.

‚ùå Funcionalidades avanzadas:

Reservas, citas, cotizaciones, pagos.

Automatizaciones.

BI avanzado.

Billing real (Stripe, etc.).

Dominios personalizados por cliente.

3. STACK TECNOL√ìGICO OFICIAL

INSTRUCCI√ìN PARA EL AGENTE
Utiliza este stack como base obligatoria. Cualquier c√≥digo generado debe respetarlo.

3.1 Backend / API

Plataforma: .NET 9

Estilo: Minimal APIs

ORM: Entity Framework Core

BD relacional: MySQL 8 (multi-tenant por columna OrganizationId)

Mapeo: Mapster (para DTOs ‚Üî Entidades)

3.2 Frontend

Framework: Blazor Server

UI Library: MudBlazor

Uso Blazor:

Panel CRM del cliente (ARISTA 2).

Landing p√∫blica (ARISTA 3), tambi√©n servida desde Blazor Server (puede ser hosteada en la misma app, con rutas p√∫blicas).

3.3 Infraestructura (lineamientos iniciales)

Entorno local:

MySQL en Docker.

Entorno futuro de producci√≥n:

Opcional: VPS con Docker/Traefik o Azure App Service + Azure Database for MySQL.

Debe existir archivo de configuraci√≥n para connection string a MySQL.

3.4 Uso de la base de datos

MySQL ser√° el repositorio principal transaccional de:

Organizaciones (tenants).

Usuarios internos.

Tarjetas (Cards).

Leads.

Multi-tenant por columna:

Todas las tablas de negocio deben tener OrganizationId.

Todas las consultas del CRM deben filtrar por OrganizationId del usuario autenticado.

4. ARQUITECTURA DE SOLUCI√ìN (PROYECTOS Y CARPETAS)

INSTRUCCI√ìN PARA EL AGENTE
Crea la soluci√≥n con esta estructura base. Luego puedes a√±adir carpetas internas seg√∫n buenas pr√°cticas, pero no cambies los nombres de los proyectos salvo que se indique.

4.1 Estructura de carpetas
/DataTouch
  /src
    DataTouch.Domain
    DataTouch.Infrastructure
    DataTouch.Api
    DataTouch.Web
  /tests
    DataTouch.Tests
  README.md

4.2 Descripci√≥n de cada proyecto
4.2.1 DataTouch.Domain (ARISTA 2 y 3 ‚Äì n√∫cleo de negocio)

Contiene:

Entidades de dominio:

Organization

User

Card

Lead

En el futuro: entidades para suscripciones, eventos, etc. (ARISTA 1, no implementar a√∫n l√≥gica).

En esta fase, sin dependencias de EF Core ni infraestructura.

4.2.2 DataTouch.Infrastructure

Contiene:

DataTouchDbContext (EF Core, MySQL).

Configuraci√≥n de entidades (Fluent API / OnModelCreating):

Multi-tenant por OrganizationId.

√çndices recomendados.

Implementaciones de repositorios o patrones de acceso a datos si se usan.

Migraciones EF Core.

4.2.3 DataTouch.Api

Contiene:

Minimal APIs para:

Endpoints p√∫blicos (Landing).

Endpoints privados (CRM).

Capa de Application Services / Use Cases (puede compartirse con Web si se decide, pero preferible aislar).

Configuraci√≥n de:

DI (Dependency Injection).

Autenticaci√≥n.

CORS (si aplica).

Logging.

Nota: se puede integrar la API y Blazor en un mismo host (Web + API) o separar. Para MVP 0.1 es aceptable que DataTouch.Web consuma internamente servicios de DataTouch.Api o que se usen Razor Components con servicios inyectados que llamen a la capa Application en el mismo proceso.

4.2.4 DataTouch.Web

Contiene:

Aplicaci√≥n Blazor Server.

Vistas del Panel CRM (ARISTA 2):

Login.

Lista de Leads.

Detalle de Lead.

Mis Tarjetas.

Vistas de la Landing p√∫blica (ARISTA 3):

P√°gina /p/{orgSlug}/{cardSlug}.

5. ARISTAS Y M√ìDULOS ‚Äì INSTRUCCIONES PARA IMPLEMENTACI√ìN
5.1 ARISTA 3 ‚Äì LANDING / BUSINESS CARD (MVP 0.1)

Objetivo:
Recibir visitas desde NFC/QR, mostrar la tarjeta y capturar datos en un formulario.

5.1.1 M√ìDULO: CARD PUBLIC VIEW

URL p√∫blica:

/p/{orgSlug}/{cardSlug}

Ejemplo: https://datatouch.app/empresa-demo/juan-perez

Comportamiento:

Resolver Organization por orgSlug, validar IsActive = true.

Resolver Card por OrganizationId y cardSlug, validar IsActive = true.

Si no existe: devolver p√°gina de error / 404.

Si existe: renderizar:

Foto (ProfileImageUrl)

Nombre (FullName)

Cargo (Title)

Bio (Bio)

Botones:

Llamar (Phone)

WhatsApp (WhatsAppNumber)

Email (Email)

5.1.2 M√ìDULO: CONTACT FORM

Campos:

FullName (obligatorio)

Email (obligatorio, formato b√°sico)

Phone (obligatorio o recomendado)

Message (opcional, longitud m√°xima recomendada p.ej. 500 chars)

Validaciones:

No enviar si faltan obligatorios.

Feedback visual de errores.

5.1.3 M√ìDULO: PUBLIC API ‚Äì CREATE LEAD

Endpoint sugerido (en DataTouch.Api):

POST /api/public/{orgSlug}/{cardSlug}/lead

L√≥gica:

Validar Organization y Card por slugs.

Construir entidad Lead con:

OrganizationId

CardId

OwnerUserId = Card.UserId

FullName, Email, Phone, Message

Source = "CARD_CONTACT_FORM"

Status = "New"

CreatedAt = UtcNow

Guardar en BD v√≠a EF Core.

Devolver 200 OK o 201 Created.

Respuesta:

En caso de √©xito: mensaje gen√©rico.

En caso de error: 400 o 500 con mensaje simple; el UI solo muestra ‚ÄúOcurri√≥ un problema, intenta de nuevo‚Äù.

5.2 ARISTA 2 ‚Äì CRM DEL CLIENTE (MVP 0.1)

Objetivo:
Permitir a los usuarios internos ver y gestionar los leads captados desde las tarjetas.

5.2.1 M√ìDULO: AUTH (LOGIN)

Vista: /login

Campos:

Email

Contrase√±a

L√≥gica:

Validar credenciales contra tabla Users.

Cargar contexto de sesi√≥n:

UserId

OrganizationId

Role

Usar cookies o JWT, pero para Blazor Server es m√°s natural cookie + Claims.

Requerimiento:

Todas las pantallas de CRM deben requerir usuario autenticado.

Toda query a datos de negocio debe filtrar por OrganizationId.

5.2.2 M√ìDULO: LEADS (LISTA Y DETALLE)

Vista: /leads

Lista:

Columnas m√≠nimas:

Fecha (CreatedAt)

Nombre (FullName)

Email

Tel√©fono

Tarjeta / Usuario (OwnerUserId ‚Üí User.FullName)

Estado (Status)

Filtros:

Fecha desde / hasta.

Estado (New, Contacted, etc.).

Opcional: por usuario due√±o.

Detalle:

Vista /leads/{id}

Mostrar todos los campos del Lead.

Permitir editar Status.

(Opcional MVP) Campo de notas internas.

5.2.3 M√ìDULO: CARDS (MIS TARJETAS)

Vista: /cards/mine

Mostrar la Card asociada al usuario autenticado.

Formulario editable:

Title, Bio, Phone, WhatsAppNumber, Email, ProfileImageUrl.

Mostrar la URL p√∫blica generada:

https://datatouch.app/{orgSlug}/{cardSlug}

En el futuro:

Vista /cards para OrgAdmin gestionando todas.

6. MODELO DE DATOS (ESQUEMA)

INSTRUCCI√ìN
El agente debe generar las entidades en DataTouch.Domain y los mapeos EF Core en DataTouch.Infrastructure siguiendo este esquema.

6.1 Organization (ARISTA 1 / base multi-tenant)
public class Organization
{
    public Guid Id { get; set; }
    public string Name { get; set; } = default!;
    public string Slug { get; set; } = default!; // √∫nico
    public string? Country { get; set; }
    public bool IsActive { get; set; } = true;
    public DateTime CreatedAt { get; set; }

    public ICollection<User> Users { get; set; } = new List<User>();
    public ICollection<Card> Cards { get; set; } = new List<Card>();
}

6.2 User (ARISTA 2)
public class User
{
    public Guid Id { get; set; }
    public Guid OrganizationId { get; set; }
    public string Email { get; set; } = default!;
    public string PasswordHash { get; set; } = default!;
    public string FullName { get; set; } = default!;
    public string Role { get; set; } = "OrgUser"; // OrgAdmin, OrgUser
    public bool IsActive { get; set; } = true;
    public DateTime CreatedAt { get; set; }

    public Organization Organization { get; set; } = default!;
    public ICollection<Card> Cards { get; set; } = new List<Card>();
}

6.3 Card (ARISTA 3 ‚Äì p√∫blica, ligada a ARISTA 2)
public class Card
{
    public Guid Id { get; set; }
    public Guid OrganizationId { get; set; }
    public Guid UserId { get; set; }
    public string Slug { get; set; } = default!; // unique por Organization
    public string FullName { get; set; } = default!;
    public string? Title { get; set; }
    public string? Bio { get; set; }
    public string? Phone { get; set; }
    public string? WhatsAppNumber { get; set; }
    public string? Email { get; set; }
    public string? ProfileImageUrl { get; set; }
    public bool IsActive { get; set; } = true;
    public DateTime CreatedAt { get; set; }
    public DateTime? UpdatedAt { get; set; }

    public Organization Organization { get; set; } = default!;
    public User User { get; set; } = default!;
    public ICollection<Lead> Leads { get; set; } = new List<Lead>();
}

6.4 Lead (ARISTA 2 ‚Äì CRM)
public class Lead
{
    public Guid Id { get; set; }
    public Guid OrganizationId { get; set; }
    public Guid CardId { get; set; }
    public Guid OwnerUserId { get; set; }
    public string FullName { get; set; } = default!;
    public string Email { get; set; } = default!;
    public string? Phone { get; set; }
    public string? Message { get; set; }
    public string Source { get; set; } = "CARD_CONTACT_FORM";
    public string Status { get; set; } = "New"; // New, Contacted, etc.
    public DateTime CreatedAt { get; set; }
    public string? Notes { get; set; }

    public Organization Organization { get; set; } = default!;
    public Card Card { get; set; } = default!;
    public User OwnerUser { get; set; } = default!;
}

7. INSTRUCCIONES FINALES PARA EL AGENTE DE DESARROLLO

Leer este documento completo antes de generar c√≥digo.

Crear la soluci√≥n y proyectos seg√∫n el √°rbol de 4.1 y 4.2.

Crear las entidades de dominio exactamente como se indican en la secci√≥n 6.

Configurar EF Core + MySQL en DataTouch.Infrastructure:

Crear DataTouchDbContext con DbSets: Organizations, Users, Cards, Leads.

Aplicar √≠ndices adecuados (especialmente en OrganizationId, Slug, CreatedAt).

Configurar autenticaci√≥n b√°sica para el panel del cliente (ARISTA 2).

Implementar los endpoints m√≠nimos descritos en secci√≥n 5 (API p√∫blica y privada).

Implementar las vistas Blazor:

Panel: Login, Leads (lista y detalle), Mis Tarjetas.

Landing p√∫blica /p/{orgSlug}/{cardSlug} con formulario y consumo del endpoint de creaci√≥n de lead.

Verificar que se cumple el flujo completo del MVP 0.1:

Escanear URL (simulado en navegador).

Ver tarjeta.

Enviar formulario.

Ver el lead en el panel del cliente.

Cuando este MVP est√© completo y estable, se podr√° usar este mismo documento como base para:

A√±adir m√≥dulos al CRM (reservas, citas, cotizaciones, pagos).

Extender el modelo de datos.

Dise√±ar y levantar requerimientos detallados de la ARISTA 1 (MultiSaaS / Panel del due√±o).